(()=>{var y=(a,r,e,v)=>function(o){for(var l=0,t=0,d=0;l<a&&t<e;l+1===a?(l=0,t++,d+=a):l++)o({cells:this,currentIndex:l+d,i:l,j:t,widthNum:a,heightNum:e,cellWidth:r,cellHeight:v})},b=a=>{for(var r=[...a],e=a.length;e--;){var v=Math.floor(Math.random()*(e+1));[r[e],r[v]]=[r[v],r[e]]}return r};var f=null,h=null,u=null,p=null,A=null,i={empty:0,alive:16,dead:15,aliveNext:8,deadNext:23,n:7,dropN:24},s=0,N=b([new Uint8Array([255,0,0,255]),new Uint8Array([0,255,0,255]),new Uint8Array([0,0,255,255]),new Uint8Array([255,255,0,255]),new Uint8Array([0,255,255,255]),new Uint8Array([255,0,255,255])]),g=Date.now(),R=4,I=1e3/R,w=0,S=(a,r,e)=>{s=Number(e);var v=s,n=s,o=a/v,l=r/n,t=s/a;return{widthNum:v,cellWidth:o,heightNum:n,cellHeight:l,sideDivider:t}},q=(a,r,e)=>{var v=r*(e*4)+a*4;return[v,v+1,v+2,v+3]},z=(a,r,e,v,n,o)=>{var l=0,t=0,d=new Uint8Array(Array.from({length:r*v},()=>(l+1===r?(l=0,t++):l++,a[q(Math.floor(l/o),Math.floor(t/o),e)[0]]<129?i.alive:i.empty)));return d},B=({cells:a,currentIndex:r,i:e,j:v,widthNum:n,heightNum:o})=>{var l=a[r],t=0;e-1>0&&a[r-1]&i.alive&&t++,e+1<n&&a[r+1]&i.alive&&t++,v-1>0&&a[r-n]&i.alive&&t++,v+1<o&&a[r+n]&i.alive&&t++,a[r]=(t===1||t===3?l|i.aliveNext:l&i.deadNext)|t},G=({currentIndex:a,cells:r,cellWidth:e,cellHeight:v,i:n,j:o})=>{var l=r[a];let t=a*4;if(l&i.alive){var d=N[l&i.n];p.data[t]=d[0],p.data[t+1]=d[1],p.data[t+2]=d[2],p.data[t+3]=d[3]}else p.data[t]=0,p.data[t+1]=0,p.data[t+2]=0,p.data[t+3]=0;r[a]=l&i.aliveNext?(l|i.alive)&i.dropN:i.empty},F=(a,r,e)=>{var v=Date.now();v-g>=I&&(a.wrappedForEach(B),a.wrappedForEach(G),A.putImageData(p,0,0),h.drawImage(u,0,0,r,e),g=v),w=requestAnimationFrame(F.bind(null,a,r,e))},L=(a,r,e)=>{a.width=r,a.height=e},T=(a,r,e,v)=>{w>0&&cancelAnimationFrame(w),L(f,r,e);var{widthNum:n,cellWidth:o,heightNum:l,cellHeight:t,sideDivider:d}=S(r,e,v),c=Math.max(a.width,a.height),m=r/c,C=a.width*m,E=a.height*m,x=(r-C)/2,U=(e-E)/2;h.drawImage(a,x,U,a.width*m,a.height*m);var D=h.getImageData(0,0,r,e).data;h.clearRect(0,0,r,e),h.fillStyle="#f00";var k=y(n,o,l,t),M=z(D,n,r,l,e,d);u=new OffscreenCanvas(n,l),A=u.getContext("2d"),p=new ImageData(n,l),Uint8Array.prototype.wrappedForEach=k,F(M,r,e)};addEventListener("message",a=>{var{canvas:r,image:e,canvasWidth:v,canvasHeight:n,resolution:o}=a.data;switch(a.data.message){case"initCanvas":f=r,h=f.getContext("2d"),h.imageSmoothingEnabled=!1;break;case"processFirstFrame":T(e,v,n,o);break}});})();
//# sourceMappingURL=worker.js.map
