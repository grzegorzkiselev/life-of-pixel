(()=>{var y=(a,r,e,t)=>function(o){for(var l=0,n=0,h=0;l<a&&n<e;l+1===a?(l=0,n++,h+=a):l++)o({cells:this,currentIndex:l+h,i:l,j:n,widthNum:a,heightNum:e,cellWidth:r,cellHeight:t})},b=a=>{for(var r=[...a],e=a.length;e--;){var t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r};var f=null,p=null,u=null,d=null,A=null,i={empty:0,alive:16,dead:15,aliveNext:8,deadNext:23,n:7,dropN:24},s=0,N=b([new Uint8Array([255,0,0,255]),new Uint8Array([0,255,0,255]),new Uint8Array([0,0,255,255]),new Uint8Array([255,255,0,255]),new Uint8Array([0,255,255,255]),new Uint8Array([255,0,255,255])]),g=Date.now(),R=4,I=1e3/R,w=0,S=(a,r,e)=>{s=Number(e);var t=s,v=s,o=a/t,l=r/v,n=s/a;return{widthNum:t,cellWidth:o,heightNum:v,cellHeight:l,sideDivider:n}},q=(a,r,e)=>{var t=r*(e*4)+a*4;return[t,t+1,t+2,t+3]},z=(a,r,e,t,v,o)=>{var l=0,n=0,h=new Uint8Array(Array.from({length:r*t},()=>(l+1===r?(l=0,n++):l++,a[q(Math.floor(l/o),Math.floor(n/o),e)[0]]<129?i.alive:i.empty)));return h},B=({cells:a,currentIndex:r,i:e,j:t,widthNum:v,heightNum:o})=>{var l=a[r],n=0;e-1>0&&a[r-1]&i.alive&&n++,e+1<v&&a[r+1]&i.alive&&n++,t-1>0&&a[r-v]&i.alive&&n++,t+1<o&&a[r+v]&i.alive&&n++,a[r]=(n===1||n===3?l|i.aliveNext:l&i.deadNext)|n},G=({currentIndex:a,cells:r})=>{var e=r[a];let t=a*4;if(e&i.alive){var v=N[e&i.n];d.data[t]=v[0],d.data[t+1]=v[1],d.data[t+2]=v[2],d.data[t+3]=v[3]}else d.data[t]=0,d.data[t+1]=0,d.data[t+2]=0,d.data[t+3]=0;r[a]=e&i.aliveNext?(e|i.alive)&i.dropN:i.empty},F=(a,r,e)=>{var t=Date.now();t-g>=I&&(a.wrappedForEach(B),a.wrappedForEach(G),A.putImageData(d,0,0),p.drawImage(u,0,0,r,e),g=t),w=requestAnimationFrame(F.bind(null,a,r,e))},L=(a,r,e)=>{a.width=r,a.height=e},T=(a,r,e,t)=>{w>0&&cancelAnimationFrame(w),L(f,r,e);var{widthNum:v,cellWidth:o,heightNum:l,cellHeight:n,sideDivider:h}=S(r,e,t),C=Math.max(a.width,a.height),m=r/C,c=a.width*m,E=a.height*m,x=(r-c)/2,U=(e-E)/2;p.drawImage(a,x,U,a.width*m,a.height*m);var D=p.getImageData(0,0,r,e).data;p.clearRect(0,0,r,e),p.fillStyle="#f00";var k=y(v,o,l,n),M=z(D,v,r,l,e,h);u=new OffscreenCanvas(v,l),A=u.getContext("2d"),d=new ImageData(v,l),Uint8Array.prototype.wrappedForEach=k,F(M,r,e)};addEventListener("message",a=>{var{canvas:r,image:e,canvasWidth:t,canvasHeight:v,resolution:o}=a.data;switch(a.data.message){case"initCanvas":f=r,p=f.getContext("2d"),p.imageSmoothingEnabled=!1;break;case"processFirstFrame":T(e,t,v,o);break}});})();
//# sourceMappingURL=worker.js.map
